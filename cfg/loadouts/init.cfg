// Initializes the loadouts script.
// Exec this on launch.

// Respawn when changing loadouts (for resup bind).
tf_respawn_on_loadoutchanges 1


// --------------
// Public Aliases
// --------------

// Use these to switch between loadouts.
alias loadouts.A "load_itempreset 0; loadouts.save.A?; loadouts.load.A"
alias loadouts.B "load_itempreset 1; loadouts.save.B?; loadouts.load.B"
alias loadouts.C "load_itempreset 2; loadouts.save.C?; loadouts.load.C"
alias loadouts.D "load_itempreset 3; loadouts.save.D?; loadouts.load.D"

// Use this to resupply.
alias loadouts.resup

// Call these when you change class.
alias loadouts.scout        "alias loadouts.store.A alias loadouts.restore.scout    loadouts.load.A; alias loadouts.store.B alias loadouts.restore.scout    loadouts.load.B; alias loadouts.store.C alias loadouts.restore.scout    loadouts.load.C; alias loadouts.store.D alias loadouts.restore.scout    loadouts.load.D; alias loadouts.set_logfile con_logfile cfg/loadouts.scout.txt   ; loadouts.restore.scout   ; echo [Loadouts] Scout loadout restored.   "
alias loadouts.soldier      "alias loadouts.store.A alias loadouts.restore.soldier  loadouts.load.A; alias loadouts.store.B alias loadouts.restore.soldier  loadouts.load.B; alias loadouts.store.C alias loadouts.restore.soldier  loadouts.load.C; alias loadouts.store.D alias loadouts.restore.soldier  loadouts.load.D; alias loadouts.set_logfile con_logfile cfg/loadouts.soldier.txt ; loadouts.restore.soldier ; echo [Loadouts] Soldier loadout restored. "
alias loadouts.pyro         "alias loadouts.store.A alias loadouts.restore.pyro     loadouts.load.A; alias loadouts.store.B alias loadouts.restore.pyro     loadouts.load.B; alias loadouts.store.C alias loadouts.restore.pyro     loadouts.load.C; alias loadouts.store.D alias loadouts.restore.pyro     loadouts.load.D; alias loadouts.set_logfile con_logfile cfg/loadouts.pyro.txt    ; loadouts.restore.pyro    ; echo [Loadouts] Pyro loadout restored.    "
alias loadouts.demoman      "alias loadouts.store.A alias loadouts.restore.demoman  loadouts.load.A; alias loadouts.store.B alias loadouts.restore.demoman  loadouts.load.B; alias loadouts.store.C alias loadouts.restore.demoman  loadouts.load.C; alias loadouts.store.D alias loadouts.restore.demoman  loadouts.load.D; alias loadouts.set_logfile con_logfile cfg/loadouts.demoman.txt ; loadouts.restore.demoman ; echo [Loadouts] Demoman loadout restored. "
alias loadouts.heavyweapons "alias loadouts.store.A alias loadouts.restore.heavy    loadouts.load.A; alias loadouts.store.B alias loadouts.restore.heavy    loadouts.load.B; alias loadouts.store.C alias loadouts.restore.heavy    loadouts.load.C; alias loadouts.store.D alias loadouts.restore.heavy    loadouts.load.D; alias loadouts.set_logfile con_logfile cfg/loadouts.heavy.txt   ; loadouts.restore.heavy   ; echo [Loadouts] Heavy loadout restored.   "
alias loadouts.engineer     "alias loadouts.store.A alias loadouts.restore.engineer loadouts.load.A; alias loadouts.store.B alias loadouts.restore.engineer loadouts.load.B; alias loadouts.store.C alias loadouts.restore.engineer loadouts.load.C; alias loadouts.store.D alias loadouts.restore.engineer loadouts.load.D; alias loadouts.set_logfile con_logfile cfg/loadouts.engineer.txt; loadouts.restore.engineer; echo [Loadouts] Engineer loadout restored."
alias loadouts.medic        "alias loadouts.store.A alias loadouts.restore.medic    loadouts.load.A; alias loadouts.store.B alias loadouts.restore.medic    loadouts.load.B; alias loadouts.store.C alias loadouts.restore.medic    loadouts.load.C; alias loadouts.store.D alias loadouts.restore.medic    loadouts.load.D; alias loadouts.set_logfile con_logfile cfg/loadouts.medic.txt   ; loadouts.restore.medic   ; echo [Loadouts] Medic loadout restored.   "
alias loadouts.sniper       "alias loadouts.store.A alias loadouts.restore.sniper   loadouts.load.A; alias loadouts.store.B alias loadouts.restore.sniper   loadouts.load.B; alias loadouts.store.C alias loadouts.restore.sniper   loadouts.load.C; alias loadouts.store.D alias loadouts.restore.sniper   loadouts.load.D; alias loadouts.set_logfile con_logfile cfg/loadouts.sniper.txt  ; loadouts.restore.sniper  ; echo [Loadouts] Sniper loadout restored.  "
alias loadouts.spy          "alias loadouts.store.A alias loadouts.restore.spy      loadouts.load.A; alias loadouts.store.B alias loadouts.restore.spy      loadouts.load.B; alias loadouts.store.C alias loadouts.restore.spy      loadouts.load.C; alias loadouts.store.D alias loadouts.restore.spy      loadouts.load.D; alias loadouts.set_logfile con_logfile cfg/loadouts.spy.txt     ; loadouts.restore.spy     ; echo [Loadouts] Spy loadout restored.     "

// Command to echo our info message.
alias loadouts "exec loadouts/echo"


// ----------------
// Internal Aliases
// ----------------

// Purpose of internal aliases:
//   loadouts.load.<slot>       Activate loadout <slot>. These are written to the save files.
//   loadouts.store.<slot>      Set `loadouts.restore.<current class>` to `loadouts.load.<slot>`.
//   loadouts.restore.<class>   Call `loadouts.load.<stored slot for class>`.
//   loadouts.save.<slot>       Append `loadouts.load.<slot>` to `cfg/loadouts.<current class>.txt`.
//   loadouts.save.<slot>?      Call `loadouts.save.<slot>` if <slot> is different from the current active slot.
//   loadouts.set_logfile       Set `con_logfile` to `cfg/loadouts.<current class>.txt`.

// Initialize each restore alias to loadout A.
alias loadouts.restore.scout    loadouts.load.A
alias loadouts.restore.soldier  loadouts.load.A
alias loadouts.restore.pyro     loadouts.load.A
alias loadouts.restore.demoman  loadouts.load.A
alias loadouts.restore.heavy    loadouts.load.A
alias loadouts.restore.engineer loadouts.load.A
alias loadouts.restore.medic    loadouts.load.A
alias loadouts.restore.sniper   loadouts.load.A
alias loadouts.restore.spy      loadouts.load.A

echo [Loadouts] Pruning save files...

// Clear controller bindings.
sixense_clear_bindings

// Load and prune the scout save file.

// Realias load aliases to set the class' restore alias.
alias loadouts.load.A alias loadouts.restore.scout loadouts.load.A; alias loadouts.load.B alias loadouts.restore.scout loadouts.load.B; alias loadouts.load.C alias loadouts.restore.scout loadouts.load.C; alias loadouts.load.D alias loadouts.restore.scout loadouts.load.D
// Load saved state. Calls the `loadouts.load.X` aliases, potentially many times.
exec loadouts.scout.txt
// Realias the `loadouts.load.X` aliases to echo a save message.
alias loadouts.load.A echo loadouts.load.A; alias loadouts.load.B echo loadouts.load.B; alias loadouts.load.C echo loadouts.load.C; alias loadouts.load.D echo loadouts.load.D
// Overwrite the save file with an empty file.
sixense_write_bindings loadouts.scout.txt
// Set console log path to the save file.
con_logfile cfg/loadouts.scout.txt
// This calls `loadouts.load.<last stored slot>`, which echoes the save message set above.
loadouts.restore.scout
// Done saving, stop logging.
con_logfile ""

// Repeat for all other classes.

alias loadouts.load.A alias loadouts.restore.soldier loadouts.load.A; alias loadouts.load.B alias loadouts.restore.soldier loadouts.load.B; alias loadouts.load.C alias loadouts.restore.soldier loadouts.load.C; alias loadouts.load.D alias loadouts.restore.soldier loadouts.load.D
exec loadouts.soldier.txt
alias loadouts.load.A echo loadouts.load.A; alias loadouts.load.B echo loadouts.load.B; alias loadouts.load.C echo loadouts.load.C; alias loadouts.load.D echo loadouts.load.D
sixense_write_bindings loadouts.soldier.txt
con_logfile cfg/loadouts.soldier.txt
loadouts.restore.soldier
con_logfile ""

alias loadouts.load.A alias loadouts.restore.pyro loadouts.load.A; alias loadouts.load.B alias loadouts.restore.pyro loadouts.load.B; alias loadouts.load.C alias loadouts.restore.pyro loadouts.load.C; alias loadouts.load.D alias loadouts.restore.pyro loadouts.load.D
exec loadouts.pyro.txt
alias loadouts.load.A echo loadouts.load.A; alias loadouts.load.B echo loadouts.load.B; alias loadouts.load.C echo loadouts.load.C; alias loadouts.load.D echo loadouts.load.D
sixense_write_bindings loadouts.pyro.txt
con_logfile cfg/loadouts.pyro.txt
loadouts.restore.pyro
con_logfile ""

alias loadouts.load.A alias loadouts.restore.demoman loadouts.load.A; alias loadouts.load.B alias loadouts.restore.demoman loadouts.load.B; alias loadouts.load.C alias loadouts.restore.demoman loadouts.load.C; alias loadouts.load.D alias loadouts.restore.demoman loadouts.load.D
exec loadouts.demoman.txt
alias loadouts.load.A echo loadouts.load.A; alias loadouts.load.B echo loadouts.load.B; alias loadouts.load.C echo loadouts.load.C; alias loadouts.load.D echo loadouts.load.D
sixense_write_bindings loadouts.demoman.txt
con_logfile cfg/loadouts.demoman.txt
loadouts.restore.demoman
con_logfile ""

alias loadouts.load.A alias loadouts.restore.heavy loadouts.load.A; alias loadouts.load.B alias loadouts.restore.heavy loadouts.load.B; alias loadouts.load.C alias loadouts.restore.heavy loadouts.load.C; alias loadouts.load.D alias loadouts.restore.heavy loadouts.load.D
exec loadouts.heavy.txt
alias loadouts.load.A echo loadouts.load.A; alias loadouts.load.B echo loadouts.load.B; alias loadouts.load.C echo loadouts.load.C; alias loadouts.load.D echo loadouts.load.D
sixense_write_bindings loadouts.heavy.txt
con_logfile cfg/loadouts.heavy.txt
loadouts.restore.heavy
con_logfile ""

alias loadouts.load.A alias loadouts.restore.engineer loadouts.load.A; alias loadouts.load.B alias loadouts.restore.engineer loadouts.load.B; alias loadouts.load.C alias loadouts.restore.engineer loadouts.load.C; alias loadouts.load.D alias loadouts.restore.engineer loadouts.load.D
exec loadouts.engineer.txt
alias loadouts.load.A echo loadouts.load.A; alias loadouts.load.B echo loadouts.load.B; alias loadouts.load.C echo loadouts.load.C; alias loadouts.load.D echo loadouts.load.D
sixense_write_bindings loadouts.engineer.txt
con_logfile cfg/loadouts.engineer.txt
loadouts.restore.engineer
con_logfile ""

alias loadouts.load.A alias loadouts.restore.medic loadouts.load.A; alias loadouts.load.B alias loadouts.restore.medic loadouts.load.B; alias loadouts.load.C alias loadouts.restore.medic loadouts.load.C; alias loadouts.load.D alias loadouts.restore.medic loadouts.load.D
exec loadouts.medic.txt
alias loadouts.load.A echo loadouts.load.A; alias loadouts.load.B echo loadouts.load.B; alias loadouts.load.C echo loadouts.load.C; alias loadouts.load.D echo loadouts.load.D
sixense_write_bindings loadouts.medic.txt
con_logfile cfg/loadouts.medic.txt
loadouts.restore.medic
con_logfile ""

alias loadouts.load.A alias loadouts.restore.sniper loadouts.load.A; alias loadouts.load.B alias loadouts.restore.sniper loadouts.load.B; alias loadouts.load.C alias loadouts.restore.sniper loadouts.load.C; alias loadouts.load.D alias loadouts.restore.sniper loadouts.load.D
exec loadouts.sniper.txt
alias loadouts.load.A echo loadouts.load.A; alias loadouts.load.B echo loadouts.load.B; alias loadouts.load.C echo loadouts.load.C; alias loadouts.load.D echo loadouts.load.D
sixense_write_bindings loadouts.sniper.txt
con_logfile cfg/loadouts.sniper.txt
loadouts.restore.sniper
con_logfile ""

alias loadouts.load.A alias loadouts.restore.spy loadouts.load.A; alias loadouts.load.B alias loadouts.restore.spy loadouts.load.B; alias loadouts.load.C alias loadouts.restore.spy loadouts.load.C; alias loadouts.load.D alias loadouts.restore.spy loadouts.load.D
exec loadouts.spy.txt
alias loadouts.load.A echo loadouts.load.A; alias loadouts.load.B echo loadouts.load.B; alias loadouts.load.C echo loadouts.load.C; alias loadouts.load.D echo loadouts.load.D
sixense_write_bindings loadouts.spy.txt
con_logfile cfg/loadouts.spy.txt
loadouts.restore.spy
con_logfile ""

// Restore controller bindings.
exec sixense_bindings

// These write the respective loadout alias into a save file.
alias loadouts.save.A "loadouts.set_logfile; echo loadouts.load.A; con_logfile ."
alias loadouts.save.B "loadouts.set_logfile; echo loadouts.load.B; con_logfile ."
alias loadouts.save.C "loadouts.set_logfile; echo loadouts.load.C; con_logfile ."
alias loadouts.save.D "loadouts.set_logfile; echo loadouts.load.D; con_logfile ."

// These set the current active loadout.
alias loadouts.load.A "alias loadouts.resup load_itempreset 0; loadouts.store.A; loadouts.cfg.A; alias loadouts.save.A?                ; alias loadouts.save.B? loadouts.save.B; alias loadouts.save.C? loadouts.save.C; alias loadouts.save.D? loadouts.save.D; echo [Loadouts] Active loadout: A"
alias loadouts.load.B "alias loadouts.resup load_itempreset 1; loadouts.store.B; loadouts.cfg.B; alias loadouts.save.A? loadouts.save.A; alias loadouts.save.B?                ; alias loadouts.save.C? loadouts.save.C; alias loadouts.save.D? loadouts.save.D; echo [Loadouts] Active loadout: B"
alias loadouts.load.C "alias loadouts.resup load_itempreset 2; loadouts.store.C; loadouts.cfg.C; alias loadouts.save.A? loadouts.save.A; alias loadouts.save.B? loadouts.save.B; alias loadouts.save.C?                ; alias loadouts.save.D? loadouts.save.D; echo [Loadouts] Active loadout: C"
alias loadouts.load.D "alias loadouts.resup load_itempreset 3; loadouts.store.D; loadouts.cfg.D; alias loadouts.save.A? loadouts.save.A; alias loadouts.save.B? loadouts.save.B; alias loadouts.save.C? loadouts.save.C; alias loadouts.save.D?                ; echo [Loadouts] Active loadout: D"

// Console message.
echo [Loadouts] Loadouts have been loaded.
